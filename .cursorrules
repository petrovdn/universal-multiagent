# .cursorrules –¥–ª—è –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã AI-–∞–≥–µ–Ω—Ç–æ–≤ Universal Multi-Agent
# LangGraph + Python + React + MCP + A2A

–í—ã ‚Äî AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã AI-–∞–≥–µ–Ω—Ç–æ–≤, –ø–æ—Å—Ç—Ä–æ–µ–Ω–Ω–æ–π –Ω–∞ LangGraph. –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –∫–∞–∫ –∞–≤—Ç–æ–Ω–æ–º–Ω—ã–π –∞–≥–µ–Ω—Ç –∏ –¥–æ–ª–∂–Ω—ã –ø–æ–ª–Ω–æ—Å—Ç—å—é —Ä–µ—à–∞—Ç—å –∑–∞–¥–∞—á–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –ø–µ—Ä–µ–¥ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–µ–º —Å–≤–æ–µ–≥–æ —Ö–æ–¥–∞.

---

## üéØ –ö–æ–Ω—Ç–µ–∫—Å—Ç –ø—Ä–æ–µ–∫—Ç–∞

### –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞
- **Backend**: Python 3.10+, LangGraph, FastAPI, WebSocket
- **Frontend**: React 18+, TypeScript, Zustand, Tailwind CSS
- **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏**: MCP (Model Context Protocol), A2A (Agent-to-Agent) ‚Äî –≤ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ
- **–ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å**: JSON-—Ñ–∞–π–ª—ã (data/sessions/), –ù–ï PostgreSQL
- **–ü–∞—Ç—Ç–µ—Ä–Ω**: ReAct (Reasoning + Acting), –º—É–ª—å—Ç–∏–∞–≥–µ–Ω—Ç–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞
- **–°—Ç—Ä–∏–º–∏–Ω–≥**: WebSocket (–ù–ï SSE)

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞
```
src/
‚îú‚îÄ‚îÄ agents/           # LangGraph –∞–≥–µ–Ω—Ç—ã (BaseAgent, MainAgent, sub-agents)
‚îú‚îÄ‚îÄ api/              # FastAPI + WebSocket (server.py, websocket_manager.py)
‚îú‚îÄ‚îÄ core/             # ReAct engine, orchestrators, providers
‚îÇ   ‚îî‚îÄ‚îÄ providers/    # MCP –∏ A2A –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã
‚îú‚îÄ‚îÄ mcp_servers/      # MCP —Å–µ—Ä–≤–µ—Ä—ã –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
‚îú‚îÄ‚îÄ mcp_tools/        # LangChain tools —á–µ—Ä–µ–∑ MCP
‚îî‚îÄ‚îÄ utils/            # Config, logging, exceptions

frontend/src/
‚îú‚îÄ‚îÄ components/       # React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
‚îú‚îÄ‚îÄ store/            # Zustand stores (chatStore, settingsStore)
‚îú‚îÄ‚îÄ services/         # API –∫–ª–∏–µ–Ω—Ç—ã
‚îî‚îÄ‚îÄ types/            # TypeScript —Ç–∏–ø—ã
```

### –§–∏–ª–æ—Å–æ—Ñ–∏—è –∫–æ–¥–∞
- –ú–∏–Ω–∏–º–∞–ª–∏—Å—Ç–∏—á–Ω—ã–π, —Ç–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π, —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–π
- –ß–µ—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ state management
- –£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —á–µ—Ä–µ–∑ ActionProvider (MCP + A2A)

---

## üìã –û–±—â–∏–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å
- –ù–ï –ñ–î–ò–¢–ï –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è ‚Äî –µ—Å–ª–∏ —Å–æ—Å—Ç–∞–≤–∏–ª–∏ –ø–ª–∞–Ω, —Å—Ä–∞–∑—É –≤—ã–ø–æ–ª–Ω—è–π—Ç–µ –µ–≥–æ
- –ï—Å–ª–∏ –Ω—É–∂–Ω–∞ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –µ—ë –ø–æ–ª—É—á–µ–Ω–∏—è
- –ó–∞–≤–µ—Ä—à–∞–π—Ç–µ –∑–∞–¥–∞—á—É –ø–æ–ª–Ω–æ—Å—Ç—å—é –ø–µ—Ä–µ–¥ –≤–æ–∑–≤—Ä–∞—Ç–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
- –ï—Å–ª–∏ —Å–æ–º–Ω–µ–≤–∞–µ—Ç–µ—Å—å –≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–º —Ñ–∞–π–ª–∞ ‚Äî —á–∏—Ç–∞–π—Ç–µ –µ–≥–æ —Ü–µ–ª–∏–∫–æ–º

### –ò–Ω–∫—Ä–µ–º–µ–Ω—Ç–∞–ª—å–Ω–æ—Å—Ç—å
- –†–∞–∑–±–∏–≤–∞–π—Ç–µ –±–æ–ª—å—à–∏–µ –∑–∞–¥–∞—á–∏ –Ω–∞ –º–∞–ª–µ–Ω—å–∫–∏–µ –ø—Ä–æ–≤–µ—Ä—è–µ–º—ã–µ —à–∞–≥–∏
- –î–µ–ª–∞–π—Ç–µ –¢–û–õ–¨–ö–û –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Ñ–∏—á–∏
- –ï—Å–ª–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –Ω–µ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏ ‚Äî –ù–ï –î–ï–õ–ê–ô–¢–ï –µ–≥–æ
- –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —à–∞–≥–∞ –ø—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å

### –ö–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è
- –ù–ò–ö–û–ì–î–ê –Ω–µ —É–ø–æ–º–∏–Ω–∞–π—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏—è –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç–æ–≤ –ø—Ä–∏ –æ–±—â–µ–Ω–∏–∏ —Å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
- –í–º–µ—Å—Ç–æ "–≤—ã–∑—ã–≤–∞—é read_file" –≥–æ–≤–æ—Ä–∏—Ç–µ "–ø—Ä–æ–≤–µ—Ä—è—é —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–∞"
- –ù–µ –≤—ã–≤–æ–¥–∏—Ç–µ –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é, –µ—Å–ª–∏ –Ω–µ –ø–æ–ø—Ä–æ—Å–∏–ª–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –§–æ—Ä–º–∞—Ç–∏—Ä—É–π—Ç–µ LaTeX –∫–∞–∫ \( \) –¥–ª—è inline –∏ \[ \] –¥–ª—è –±–ª–æ–∫–æ–≤

---

## üêç Backend: Python + LangGraph

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ State (–ö–†–ò–¢–ò–ß–ù–û)
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π, —Ç–∏–ø–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π State
from typing import TypedDict, Annotated, List, Any, Optional
import operator

class AgentState(TypedDict):
    """State for LangGraph agent execution."""
    messages: Annotated[List[Any], operator.add]  # operator.add –¥–ª—è –∞–∫–∫—É–º—É–ª—è—Ü–∏–∏
    error: Optional[str]
    # –ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ context, tools ‚Äî –æ–Ω–∏ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –†–∞–∑–¥—É—Ç—ã–π State
class AgentState(TypedDict):
    messages: list  # –ë–µ–∑ reducer
    context: Any    # Context –ù–ï —Å–µ—Ä–∏–∞–ª–∏–∑—É–µ—Ç—Å—è ‚Äî –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ –≤ state
    everything: dict  # –°–ª–∏—à–∫–æ–º –æ–±—â–µ–µ
```

**–ü—Ä–∞–≤–∏–ª–∞ State:**
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `TypedDict` –¥–ª—è –≤—Å–µ—Ö State –æ–±—ä–µ–∫—Ç–æ–≤
- `operator.add` –¥–ª—è –∞–∫–∫—É–º—É–ª—è—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π (–ù–ï `add_messages`)
- –ù–ï —Ö—Ä–∞–Ω–∏—Ç–µ `ConversationContext` –≤ state ‚Äî –æ–Ω —É–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è –æ—Ç–¥–µ–ª—å–Ω–æ
- –ú–∏–Ω–∏–º—É–º –ø–æ–ª–µ–π ‚Äî —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è –≥—Ä–∞—Ñ–∞

### –ù–æ–¥—ã –≥—Ä–∞—Ñ–∞
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ß–∏—Å—Ç–∞—è —Ñ—É–Ω–∫—Ü–∏—è —Å partial update
async def agent_node(state: AgentState) -> dict:
    """–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—Ç–≤–µ—Ç."""
    messages = state["messages"]
    response = await llm.ainvoke(messages)
    return {"messages": [response]}  # Partial update

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ú—É—Ç–∞—Ü–∏—è state –Ω–∞–ø—Ä—è–º—É—é
def agent_node(state: AgentState):
    state["messages"].append(response)  # –ú—É—Ç–∞—Ü–∏—è!
    return state
```

### Edges –∏ —É—Å–ª–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä–æ—Å—Ç—ã–µ edges –¥–ª—è –ª–∏–Ω–µ–π–Ω—ã—Ö —à–∞–≥–æ–≤
workflow.add_edge("tools", "agent")

# –£—Å–ª–æ–≤–Ω—ã–µ edges –¥–ª—è tool calls
workflow.add_conditional_edges(
    "agent",
    should_continue,  # –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç "continue" –∏–ª–∏ "end"
    {"continue": "tools", "end": END}
)

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –£—Å–ª–æ–≤–Ω—ã–µ edges –≤–µ–∑–¥–µ
workflow.add_conditional_edges("every", "single", "node")
```

### –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (–ù–ï PostgreSQL!)
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: LangGraph checkpointer –û–¢–ö–õ–Æ–ß–ï–ù
compiled_graph = workflow.compile()  # –ë–µ–∑ checkpointer

# –ü–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —á–µ—Ä–µ–∑ PersistentStorage (JSON-—Ñ–∞–π–ª—ã)
from src.core.context_manager import PersistentStorage, ConversationContext

storage = PersistentStorage(storage_dir=Path("data/sessions"))
storage.save_context(context)
context = storage.load_context(session_id)

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: PostgreSQL checkpointer (–Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω –≤ –ø—Ä–æ–µ–∫—Ç–µ)
from langgraph.checkpoint.postgres import PostgresSaver  # –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú
```

**–ü—Ä–∏—á–∏–Ω–∞**: `ConversationContext` —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–µ—Å–µ—Ä–∏–∞–ª–∏–∑—É–µ–º—ã–µ –æ–±—ä–µ–∫—Ç—ã. –ò—Å–ø–æ–ª—å–∑—É–µ–º —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—É—é JSON-based –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

---

## üîå –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏: MCP + A2A

### ActionProvider ‚Äî —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å (–ö–†–ò–¢–ò–ß–ù–û!)
```python
# src/core/action_provider.py ‚Äî –±–∞–∑–æ–≤—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
from abc import ABC, abstractmethod
from enum import Enum

class ProviderType(Enum):
    MCP_TOOL = "mcp_tool"      # –¢–µ–∫—É—â–∏–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏
    A2A_AGENT = "a2a_agent"    # –ë—É–¥—É—â–∏–µ –∞–≥–µ–Ω—Ç—ã
    LOCAL_FUNCTION = "local"   # –õ–æ–∫–∞–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏

class ActionProvider(ABC):
    @abstractmethod
    async def execute(self, capability_name: str, arguments: dict) -> Any:
        pass
    
    @abstractmethod
    def get_capabilities(self) -> List[ActionCapability]:
        pass

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –î–æ–±–∞–≤–ª—è–π—Ç–µ –Ω–æ–≤—ã–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ ActionProvider
# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä—è–º—ã–µ HTTP –≤—ã–∑–æ–≤—ã –∫ –≤–Ω–µ—à–Ω–∏–º API
```

### MCP –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (—Ç–µ–∫—É—â–∏–π —Å—Ç–µ–∫)
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ MCP tools –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
from src.mcp_tools.calendar_tools import get_calendar_tools
from src.mcp_tools.gmail_tools import get_gmail_tools
from src.mcp_tools.sheets_tools import get_sheets_tools
from src.mcp_tools.onec_tools import get_onec_tools
from src.mcp_tools.projectlad_tools import get_projectlad_tools

# MCP —Å–µ—Ä–≤–µ—Ä—ã –≤ src/mcp_servers/
# Transport: stdio (–ª–æ–∫–∞–ª—å–Ω—ã–µ Python —Å–µ—Ä–≤–µ—Ä—ã)

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ü—Ä—è–º—ã–µ –≤—ã–∑–æ–≤—ã Google API
from googleapiclient.discovery import build  # –ù–ï –î–ï–õ–ê–ô–¢–ï –¢–ê–ö!
```

### A2A –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ (–±—É–¥—É—â–µ–µ)
```python
# src/core/providers/a2a_provider.py ‚Äî placeholder –¥–ª—è A2A
from src.core.action_provider import ActionProvider, ProviderType

class A2AAgentProvider(ActionProvider):
    """
    –ë—É–¥—É—â–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ Agent-to-Agent –ø—Ä–æ—Ç–æ–∫–æ–ª–∞.
    
    –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–π —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª:
    1. Discover agents via Agent Cards (.well-known/agent.json)
    2. Parse agent skills/capabilities
    3. Route requests via A2A protocol
    4. Handle responses in unified format
    """
    
    async def discover_agents(self, agent_card_urls: List[str]) -> List[str]:
        # TODO: Fetch and parse Agent Cards
        pass
    
    @property
    def provider_type(self) -> ProviderType:
        return ProviderType.A2A_AGENT

# –ü—Ä–∏ –¥–æ–±–∞–≤–ª–µ–Ω–∏–∏ A2A:
# 1. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥—ã –≤ A2AAgentProvider
# 2. –î–æ–±–∞–≤—å—Ç–µ Agent Card parsing
# 3. –ò–Ω—Ç–µ–≥—Ä–∏—Ä—É–π—Ç–µ –≤ CapabilityRegistry
# 4. –ù–ï –º–µ–Ω—è–π—Ç–µ ReAct engine ‚Äî –æ–Ω —Ä–∞–±–æ—Ç–∞–µ—Ç —á–µ—Ä–µ–∑ ActionProvider
```

### CapabilityRegistry ‚Äî –µ–¥–∏–Ω—ã–π —Ä–µ–µ—Å—Ç—Ä
```python
# src/core/capability_registry.py
# –†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–µ—Ç capabilities –æ—Ç –≤—Å–µ—Ö –ø—Ä–æ–≤–∞–π–¥–µ—Ä–æ–≤ (MCP + A2A)

# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –î–æ–±–∞–≤–ª—è–π—Ç–µ –ø—Ä–æ–≤–∞–π–¥–µ—Ä—ã —á–µ—Ä–µ–∑ —Ä–µ–µ—Å—Ç—Ä
registry.register_provider(mcp_provider)
registry.register_provider(a2a_provider)  # –ö–æ–≥–¥–∞ –±—É–¥–µ—Ç –≥–æ—Ç–æ–≤

capabilities = registry.get_all_capabilities()
```

---

## üéõÔ∏è –°—Ç—Ä–∏–º–∏–Ω–≥ (WebSocket, –ù–ï SSE)

```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: WebSocket –¥–ª—è real-time
# src/api/websocket_manager.py
async for chunk in graph.astream(state, stream_mode="messages"):
    await websocket.send_json({
        "type": "token",
        "content": chunk
    })

# stream_mode –≤–∞—Ä–∏–∞–Ω—Ç—ã:
# - "messages" ‚Äî –¥–ª—è chat UI (—Ç–æ–∫–µ–Ω—ã LLM) ‚Üê –ò–°–ü–û–õ–¨–ó–£–ï–ú
# - "updates" ‚Äî –¥–ª—è –¥–∞—à–±–æ—Ä–¥–æ–≤ (–¥–µ–ª—å—Ç—ã state)
# - "values" ‚Äî –ø–æ–ª–Ω—ã–µ —Å–Ω–∏–º–∫–∏ (–∏–∑–±—ã—Ç–æ—á–Ω–æ)

# ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: SSE
from sse_starlette import EventSourceResponse  # –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú
```

---

## ‚öõÔ∏è Frontend: React + TypeScript + Zustand

### State Management ‚Äî Zustand (–ù–ï Context+useReducer!)
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Zustand —Å persist
import { create } from 'zustand'
import { persist } from 'zustand/middleware'

interface ChatState {
  messages: Message[]
  isConnected: boolean
  isAgentTyping: boolean
  workflows: Record<string, Workflow>
  
  addMessage: (msg: Message) => void
  setConnectionStatus: (connected: boolean) => void
}

export const useChatStore = create<ChatState>()(
  persist(
    (set, get) => ({
      messages: [],
      isConnected: false,
      isAgentTyping: false,
      workflows: {},
      
      addMessage: (msg) => set((state) => ({
        messages: [...state.messages, msg]
      })),
      
      setConnectionStatus: (connected) => set({ isConnected: connected }),
    }),
    {
      name: 'chat-storage',
      partialize: (state) => ({
        // –ù–µ –ø–µ—Ä—Å–∏—Å—Ç–∏–º –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
        currentSession: state.currentSession,
      }),
    }
  )
)

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: Context + useReducer –¥–ª—è –≥–ª–æ–±–∞–ª—å–Ω–æ–≥–æ state
import { createContext, useReducer } from 'react'  // –ù–ï –¥–ª—è state management
```

### –¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –°—Ç—Ä–æ–≥–∏–µ —Ç–∏–ø—ã
interface Message {
  role: 'user' | 'assistant' | 'system'
  content: string
  timestamp: string
  metadata?: Record<string, unknown>  // unknown –≤–º–µ—Å—Ç–æ any –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ
}

interface WorkflowStep {
  stepNumber: number
  title: string
  status: 'pending' | 'in_progress' | 'completed'
  thinking: string
  response: string
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
interface Message {
  role: string       // –°–ª–∏—à–∫–æ–º —à–∏—Ä–æ–∫–æ
  content: any       // –ò–∑–±–µ–≥–∞–π—Ç–µ any
  metadata?: any     // –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ Record<string, unknown>
}
```

### WebSocket –∫–ª–∏–µ–Ω—Ç
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: WebSocket –¥–ª—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞
const connectWebSocket = (sessionId: string) => {
  const ws = new WebSocket(`ws://localhost:8000/ws/${sessionId}`)
  
  ws.onmessage = (event) => {
    const data = JSON.parse(event.data)
    
    switch (data.type) {
      case 'token':
        // –°—Ç—Ä–∏–º–∏–Ω–≥ —Ç–æ–∫–µ–Ω–æ–≤
        updateStreamingMessage(data.content)
        break
      case 'tool_call':
        // Tool –≤—ã–∑–æ–≤
        addToolCall(data)
        break
      case 'message_complete':
        // –°–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–≤–µ—Ä—à–µ–Ω–æ
        completeMessage(data)
        break
    }
  }
  
  return ws
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: SSE –∏–ª–∏ polling
const eventSource = new EventSource('/stream')  // –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú
```

### –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è ‚Äî Tailwind CSS
```tsx
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: Tailwind –∫–ª–∞—Å—Å—ã
<div className="flex items-center gap-2 p-4 bg-gray-100 dark:bg-gray-800 rounded-lg shadow-sm">
  <div className="flex-1">
    <p className="text-sm font-medium text-gray-900 dark:text-white">
      {message.content}
    </p>
    <span className="text-xs text-gray-500">{timestamp}</span>
  </div>
</div>

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: Inline styles –∏–ª–∏ CSS-in-JS
<div style={{ display: 'flex', padding: '1rem' }}>  // –ù–ï –ò–°–ü–û–õ–¨–ó–£–ï–ú
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç —Å —Ç–∏–ø–∞–º–∏
interface ChatMessageProps {
  message: Message
  isStreaming?: boolean
  onRetry?: () => void
}

export const ChatMessage: React.FC<ChatMessageProps> = ({ 
  message, 
  isStreaming = false,
  onRetry 
}) => {
  const { role, content, timestamp } = message
  
  return (
    <div className={`chat-message ${role}`}>
      {/* JSX */}
    </div>
  )
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û: –ö–ª–∞—Å—Å–æ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
class ChatMessage extends React.Component {  // –£—Å—Ç–∞—Ä–µ–≤—à–∏–π –ø–æ–¥—Ö–æ–¥
```

---

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### Backend config (Pydantic)
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: src/utils/config_loader.py —É–∂–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω
from pydantic_settings import BaseSettings

class AppConfig(BaseSettings):
    anthropic_api_key: Optional[str] = Field(alias="ANTHROPIC_API_KEY")
    openai_api_key: Optional[str] = Field(alias="OPENAI_API_KEY")
    default_model: str = Field(default="gpt-4o", alias="DEFAULT_MODEL")
    
    model_config = SettingsConfigDict(
        env_file="config/.env",
        extra="ignore"
    )

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ:
from src.utils.config_loader import get_config
config = get_config()
```

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –∫–æ–Ω—Ñ–∏–≥–æ–≤
```
config/
‚îú‚îÄ‚îÄ .env                    # –°–µ–∫—Ä–µ—Ç—ã (API keys) ‚Äî –ù–ï –≤ git
‚îú‚îÄ‚îÄ onec_config.json        # 1–° OData –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ projectlad_config.json  # Project Lad –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îú‚îÄ‚îÄ users.json              # –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏
‚îî‚îÄ‚îÄ *_token.json            # OAuth —Ç–æ–∫–µ–Ω—ã
```

---

## üß™ TDD-–ø–æ–¥—Ö–æ–¥ (Test-Driven Development)

### –§–∏–ª–æ—Å–æ—Ñ–∏—è
- **–¢–µ—Å—Ç—ã –ø–µ—Ä–≤—ã–º–∏**: –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å–Ω–∞—á–∞–ª–∞ –ø–∏—à–µ–º failing —Ç–µ—Å—Ç, –ø–æ—Ç–æ–º —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é
- **–ö—Ä–∞—Å–Ω—ã–π-–ó–µ–ª—ë–Ω—ã–π-–†–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥**: –¢–µ—Å—Ç –ø–∞–¥–∞–µ—Ç ‚Üí –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ ‚Üí —Ç–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç ‚Üí —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥
- **–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏**: –ù–∏–∫–∞–∫–∏—Ö —Ä—É—á–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ ‚Äî –≤—Å—ë —á–µ—Ä–µ–∑ –∞–≤—Ç–æ—Ç–µ—Å—Ç—ã

### –£—Ä–æ–≤–Ω–∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
1. **Unit —Ç–µ—Å—Ç—ã** (pytest / Jest) ‚Äî –æ—Ç–¥–µ–ª—å–Ω—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏ –∏ –º–µ—Ç–æ–¥—ã
2. **Integration —Ç–µ—Å—Ç—ã** ‚Äî –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤ (backend + WebSocket)
3. **E2E —Ç–µ—Å—Ç—ã** (Playwright) ‚Äî –ø–æ–ª–Ω—ã–π flow —á–µ—Ä–µ–∑ –±—Ä–∞—É–∑–µ—Ä

### Workflow –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∏—á

```
1. –ü–õ–ê–ù–ò–†–û–í–ê–ù–ò–ï
   ‚îî‚îÄ‚îÄ –ü–æ–ª—É—á–∞–µ–º –∑–∞–¥–∞—á—É –æ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
   ‚îî‚îÄ‚îÄ –û–ø—Ä–µ–¥–µ–ª—è–µ–º –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ (—á—Ç–æ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å)

2. –¢–ï–°–¢–´ (–¥–æ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏!)
   ‚îî‚îÄ‚îÄ –ü–∏—à–µ–º failing —Ç–µ—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è
   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫–∞–µ–º ‚Äî —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∞–¥–∞–µ—Ç
   ‚îî‚îÄ‚îÄ –ï—Å–ª–∏ —Ç–µ—Å—Ç –Ω–µ –ø–∞–¥–∞–µ—Ç ‚Äî —É—Ç–æ—á–Ω—è–µ–º —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

3. –†–ï–ê–õ–ò–ó–ê–¶–ò–Ø
   ‚îî‚îÄ‚îÄ –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–æ–≤
   ‚îî‚îÄ‚îÄ –ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è ‚Äî –∑–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
   ‚îî‚îÄ‚îÄ –ù–µ –¥–æ–±–∞–≤–ª—è–µ–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª –±–µ–∑ —Ç–µ—Å—Ç–æ–≤

4. –†–ï–§–ê–ö–¢–û–†–ò–ù–ì
   ‚îî‚îÄ‚îÄ –¢–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ ‚Äî –º–æ–∂–Ω–æ —É–ª—É—á—à–∞—Ç—å –∫–æ–¥
   ‚îî‚îÄ‚îÄ –ü–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞ ‚Äî —Ç–µ—Å—Ç—ã –≤—Å—ë –µ—â—ë –∑–µ–ª—ë–Ω—ã–µ
```

### Workflow –¥–ª—è –±–∞–≥—Ñ–∏–∫—Å–æ–≤

```
1. –í–û–°–ü–†–û–ò–ó–í–ï–î–ï–ù–ò–ï
   ‚îî‚îÄ‚îÄ –ü–æ–Ω–∏–º–∞–µ–º –±–∞–≥
   ‚îî‚îÄ‚îÄ –ü–∏—à–µ–º failing —Ç–µ—Å—Ç, –∫–æ—Ç–æ—Ä—ã–π –≤–æ—Å–ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç –±–∞–≥
   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫–∞–µ–º ‚Äî —É–±–µ–∂–¥–∞–µ–º—Å—è, —á—Ç–æ –ø–∞–¥–∞–µ—Ç

2. –ò–°–ü–†–ê–í–õ–ï–ù–ò–ï
   ‚îî‚îÄ‚îÄ –ú–∏–Ω–∏–º–∞–ª—å–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –¥–ª—è –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫–∞–µ–º —Ç–µ—Å—Ç ‚Äî —Ç–µ–ø–µ—Ä—å –ø—Ä–æ—Ö–æ–¥–∏—Ç
   ‚îî‚îÄ‚îÄ –ó–∞–ø—É—Å–∫–∞–µ–º –≤—Å–µ —Ç–µ—Å—Ç—ã ‚Äî —Ä–µ–≥—Ä–µ—Å—Å–∏–π –Ω–µ—Ç

3. –î–û–ö–£–ú–ï–ù–¢–ê–¶–ò–Ø
   ‚îî‚îÄ‚îÄ –¢–µ—Å—Ç –æ—Å—Ç–∞—ë—Ç—Å—è –∫–∞–∫ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π
   ‚îî‚îÄ‚îÄ –û–ø–∏—Å–∞–Ω–∏–µ –±–∞–≥–∞ –≤ –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∫ —Ç–µ—Å—Ç—É
```

### –ü—Ä–∏–º–µ—Ä—ã —Ç–µ—Å—Ç–æ–≤

#### Backend: pytest + mock WebSocket
```python
# test_agent_simple_request.py
import pytest
from unittest.mock import AsyncMock

class MockWebSocketManager:
    """–ú–æ–∫ –¥–ª—è –∑–∞—Ö–≤–∞—Ç–∞ WebSocket —Å–æ–±—ã—Ç–∏–π."""
    def __init__(self):
        self.events = []
    
    async def send_event(self, session_id, event_type, data):
        self.events.append({"type": event_type, "data": data})

@pytest.mark.asyncio
async def test_agent_mode_simple_request_sends_final_result():
    """
    –¢–µ—Å—Ç: Agent mode –¥–ª—è –ø—Ä–æ—Å—Ç–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å 'final_result'.
    –ë–∞–≥: –†–∞–Ω—å—à–µ –æ—Ç–ø—Ä–∞–≤–ª—è–ª 'message_complete', UI –Ω–µ –æ—Ç–æ–±—Ä–∞–∂–∞–ª –æ—Ç–≤–µ—Ç.
    """
    mock_ws = MockWebSocketManager()
    # ... setup agent with mock_ws ...
    
    result = await agent.process("–Ω–∞–ø–∏—à–∏ —Ö–æ–∫–∫—É")
    
    final_result_events = [e for e in mock_ws.events if e["type"] == "final_result"]
    assert len(final_result_events) > 0, "Agent mode –¥–æ–ª–∂–µ–Ω –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å final_result"
    assert len(final_result_events[0]["data"]["content"]) > 10
```

#### Frontend: Playwright E2E
```typescript
// tests/e2e/agent-mode.spec.ts
import { test, expect } from '@playwright/test'

test('agent mode displays response for simple query', async ({ page }) => {
  await page.goto('/')
  
  // –ü–µ—Ä–µ–∫–ª—é—á–∞–µ–º—Å—è –≤ agent mode
  await page.click('[data-testid="mode-selector"]')
  await page.click('text=–ê–≥–µ–Ω—Ç')
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –ø—Ä–æ—Å—Ç–æ–π –∑–∞–ø—Ä–æ—Å
  await page.fill('[data-testid="chat-input"]', '–Ω–∞–ø–∏—à–∏ —Ö–æ–∫–∫—É')
  await page.click('[data-testid="send-button"]')
  
  // –û–∂–∏–¥–∞–µ–º –ø–æ—è–≤–ª–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–∞ (–Ω–µ loading spinner)
  await expect(page.locator('[data-testid="assistant-message"]')).toBeVisible({ timeout: 30000 })
  
  // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –æ—Ç–≤–µ—Ç –Ω–µ –ø—É—Å—Ç–æ–π
  const response = await page.locator('[data-testid="assistant-message"]').textContent()
  expect(response?.length).toBeGreaterThan(10)
})
```

### –ö–æ–º–∞–Ω–¥—ã —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

```bash
# Backend
python -m pytest tests/ -v                    # –í—Å–µ —Ç–µ—Å—Ç—ã
python -m pytest tests/test_agent.py -v       # –û–¥–∏–Ω —Ñ–∞–π–ª
python -m pytest tests/ -k "simple_request"   # –ü–æ –∏–º–µ–Ω–∏

# Frontend E2E (Playwright)
cd frontend && npx playwright test            # –í—Å–µ E2E —Ç–µ—Å—Ç—ã
npx playwright test --ui                      # –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Ä–µ–∂–∏–º
npx playwright test agent-mode.spec.ts        # –û–¥–∏–Ω —Ñ–∞–π–ª

# Watch mode (–ø—Ä–∏ —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–µ)
python -m pytest tests/ --watch               # —Å pytest-watch
npx playwright test --ui                      # Playwright UI
```

### –ö–æ–≥–¥–∞ –ø–∏—Å–∞—Ç—å E2E vs Unit —Ç–µ—Å—Ç—ã

| –¢–∏–ø —Ç–µ—Å—Ç–∞ | –ö–æ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å |
|-----------|-------------------|
| Unit      | –õ–æ–≥–∏–∫–∞, –≤—ã—á–∏—Å–ª–µ–Ω–∏—è, —Ç—Ä–∞–Ω—Å—Ñ–æ—Ä–º–∞—Ü–∏–∏ –¥–∞–Ω–Ω—ã—Ö |
| Integration | WebSocket —Å–æ–±—ã—Ç–∏—è, API –æ—Ç–≤–µ—Ç—ã, store updates |
| E2E       | User flows, –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –ø—É—Ç–∏, –≤–∏–∑—É–∞–ª—å–Ω—ã–µ –±–∞–≥–∏ |

### –ß–µ–∫–ª–∏—Å—Ç TDD

–ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:
- [ ] –°—Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∞–ª –∫—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞
- [ ] –ù–∞–ø–∏—Å–∞–ª failing —Ç–µ—Å—Ç –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∫—Ä–∏—Ç–µ—Ä–∏—è
- [ ] –£–±–µ–¥–∏–ª—Å—è, —á—Ç–æ —Ç–µ—Å—Ç –ø–∞–¥–∞–µ—Ç –ø–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–π –ø—Ä–∏—á–∏–Ω–µ

–ü—Ä–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:
- [ ] –ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–æ–¥ –¥–ª—è –ø—Ä–æ—Ö–æ–∂–¥–µ–Ω–∏—è —Ç–µ—Å—Ç–∞
- [ ] –¢–µ—Å—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç
- [ ] –í—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ —Ç–µ—Å—Ç—ã –≤—Å—ë –µ—â—ë –ø—Ä–æ—Ö–æ–¥—è—Ç

–ü—Ä–∏ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–µ:
- [ ] –¢–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ –¥–æ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –¢–µ—Å—Ç—ã –∑–µ–ª—ë–Ω—ã–µ –ø–æ—Å–ª–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π
- [ ] –ö–æ–¥ —Å—Ç–∞–ª —á–∏—â–µ/–ø—Ä–æ—â–µ

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ (—Å–ø—Ä–∞–≤–æ—á–Ω–∏–∫)

### Backend —Ç–µ—Å—Ç—ã
```python
# ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: –¢–µ—Å—Ç–∏—Ä—É–µ–º –∞–≥–µ–Ω—Ç–æ–≤ —á–µ—Ä–µ–∑ execute
import pytest
from src.agents.main_agent import MainAgent
from src.core.context_manager import ConversationContext

@pytest.mark.asyncio
async def test_agent_execution():
    agent = MainAgent()
    context = ConversationContext(session_id="test-session")
    
    result = await agent.execute(
        user_message="–ü–æ–∫–∞–∂–∏ –≤—Å—Ç—Ä–µ—á–∏ –Ω–∞ –∑–∞–≤—Ç—Ä–∞",
        context=context
    )
    
    assert result["agent"] == "MainAgent"
    assert "response" in result
    assert len(result["response"]) > 0

# –ú–æ–∫–∞–π—Ç–µ MCP tools
@pytest.fixture
def mock_calendar_tools(mocker):
    mocker.patch(
        'src.mcp_tools.calendar_tools.list_events',
        return_value={"events": []}
    )
```

### Frontend —Ç–µ—Å—Ç—ã
```typescript
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û: React Testing Library
import { render, screen, fireEvent } from '@testing-library/react'
import { ChatMessage } from './ChatMessage'

test('renders message content', () => {
  const message = {
    role: 'assistant' as const,
    content: 'Hello, world!',
    timestamp: new Date().toISOString()
  }
  
  render(<ChatMessage message={message} />)
  
  expect(screen.getByText('Hello, world!')).toBeInTheDocument()
})
```

---

## üöÄ –ü–æ–ª–µ–∑–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# Backend
python -m pytest tests/ -v              # –¢–µ—Å—Ç—ã
mypy src/                               # –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ç–∏–ø–æ–≤
ruff check src/                         # –õ–∏–Ω—Ç–∏–Ω–≥
python -m uvicorn src.api.server:app    # –ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞

# Frontend
npm run dev                             # Dev —Å–µ—Ä–≤–µ—Ä
npm run build                           # Production build
npm run lint                            # ESLint
npm run type-check                      # TypeScript –ø—Ä–æ–≤–µ—Ä–∫–∞

# –ü–µ—Ä–µ–∑–∞–ø—É—Å–∫
./restart-server.sh                     # Backend
./restart-frontend.sh                   # Frontend
./restart-all.sh                        # –í—Å–µ
```

---

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –î–≤—É—Ö—à–∞–≥–æ–≤–∞—è –æ—Ç–ª–∞–¥–∫–∞
1. **–ê–Ω–∞–ª–∏–∑** (–±–µ–∑ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è):
   - –û–°–¢–ê–ù–û–í–ò–¢–ï–°–¨ ‚Äî –Ω–µ –∏—Å–ø—Ä–∞–≤–ª—è–π—Ç–µ —Å—Ä–∞–∑—É
   - –°—Ñ–æ—Ä–º—É–ª–∏—Ä—É–π—Ç–µ 3-5 –≥–∏–ø–æ—Ç–µ–∑
   - –í—ã–±–µ—Ä–∏—Ç–µ –Ω–∞–∏–±–æ–ª–µ–µ –≤–µ—Ä–æ—è—Ç–Ω—É—é

2. **–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ**:
   - –ó–∞–ø—Ä–æ—Å–∏—Ç–µ –ø–ª–∞–Ω –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–ª–∞–Ω
   - –°–æ–∑–¥–∞–π—Ç–µ —Ä–µ–≥—Ä–µ—Å—Å–∏–æ–Ω–Ω—ã–π —Ç–µ—Å—Ç

### –ü—Ä–∏–∑–Ω–∞–∫–∏ —Ü–∏–∫–ª–∞ AI
- AI –ø–æ—Å—Ç–æ—è–Ω–Ω–æ –∏–∑–≤–∏–Ω—è–µ—Ç—Å—è –∏ –Ω–∞—á–∏–Ω–∞–µ—Ç —Å –Ω—É–ª—è
- –†–µ—à–µ–Ω–∏—è —Å—Ç–∞–Ω–æ–≤—è—Ç—Å—è —Å–ª–æ–∂–Ω–µ–µ –≤–º–µ—Å—Ç–æ –ø—Ä–æ—â–µ
- –û–¥–Ω–∞ –æ—à–∏–±–∫–∞ "–∏—Å–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è" –º–Ω–æ–≥–æ–∫—Ä–∞—Ç–Ω–æ

**–ö–∞–∫ —Ä–∞–∑–æ—Ä–≤–∞—Ç—å:**
1. STOP ‚Äî –ø—Ä–µ–∫—Ä–∞—Ç–∏—Ç–µ –ø—Ä–∏–Ω–∏–º–∞—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
2. –û—Ç–∫–∞—Ç –∫ —Ä–∞–±–æ—á–µ–º—É —Å–æ—Å—Ç–æ—è–Ω–∏—é (`git revert`)
3. –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –Ω–∞ –∞–Ω–∞–ª–∏–∑ (–Ω–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ)
4. –ó–∞–ø—Ä–æ—Å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –ø–æ–¥—Ö–æ–¥–∞

---

## üìù –ö–æ–Ω—Ç—Ä–æ–ª—å–Ω—ã–π —á–µ–∫–ª–∏—Å—Ç

### –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –∑–∞–¥–∞—á–∏:
- [ ] –ü–æ–Ω—è–ª —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è –ø–æ–ª–Ω–æ—Å—Ç—å—é
- [ ] –û–ø—Ä–µ–¥–µ–ª–∏–ª –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–π –∫–æ–¥ —á–µ—Ä–µ–∑ –ø–æ–∏—Å–∫
- [ ] –°–æ—Å—Ç–∞–≤–∏–ª –ø–ª–∞–Ω —Å 2-4 —à–∞–≥–∞–º–∏

### –†–µ–∞–ª–∏–∑–∞—Ü–∏—è:
- [ ] –ò–∑–º–µ–Ω—è—é –¢–û–õ–¨–ö–û –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ —Ñ–∞–π–ª—ã
- [ ] –°–ª–µ–¥—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä–µ State (TypedDict + operator.add)
- [ ] –î–æ–±–∞–≤–∏–ª —Ç–∏–ø—ã –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π/–∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [ ] –ò—Å–ø–æ–ª—å–∑—É—é ActionProvider –¥–ª—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–π
- [ ] –û–±—Ä–∞–±–æ—Ç–∞–ª –æ—à–∏–±–∫–∏ –∏ edge cases

### –ü—Ä–æ–≤–µ—Ä–∫–∞:
- [ ] –ù–µ—Ç TypeScript/mypy –æ—à–∏–±–æ–∫
- [ ] –°–æ–∑–¥–∞–ª/–æ–±–Ω–æ–≤–∏–ª —Ç–µ—Å—Ç—ã
- [ ] –ü—Ä–æ–≤–µ—Ä–∏–ª —Ä–∞–±–æ—Ç—É –≤ runtime
- [ ] –î–æ–±–∞–≤–∏–ª –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –æ–ø–µ—Ä–∞—Ü–∏–π

### –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ:
- [ ] –£–¥–∞–ª–∏–ª debug –∫–æ–¥
- [ ] –ö–æ–¥ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç style guide
- [ ] –ì–æ—Ç–æ–≤ –∫ –∫–æ–º–º–∏—Ç—É

---

## üí° –ü–æ–º–Ω–∏ –≥–ª–∞–≤–Ω–æ–µ

1. **–ê–≤—Ç–æ–Ω–æ–º–Ω–æ—Å—Ç—å**: –†–µ—à–∞–π –∑–∞–¥–∞—á—É –¥–æ –∫–æ–Ω—Ü–∞, –Ω–µ –∂–¥–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
2. **–ú–∏–Ω–∏–º–∞–ª–∏–∑–º**: –ú–µ–Ω—è–π —Ç–æ–ª—å–∫–æ —Ç–æ, —á—Ç–æ –Ω—É–∂–Ω–æ –¥–ª—è —Ç–µ–∫—É—â–µ–π –∑–∞–¥–∞—á–∏
3. **–¢–∏–ø–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: TypedDict –¥–ª—è Python, —Å—Ç—Ä–æ–≥–∏–π TypeScript –¥–ª—è React
4. **ActionProvider**: –í—Å–µ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å
5. **Zustand, –Ω–µ Context**: –ò—Å–ø–æ–ª—å–∑—É–π Zustand –¥–ª—è state management
6. **WebSocket, –Ω–µ SSE**: –°—Ç—Ä–∏–º–∏–Ω–≥ —á–µ—Ä–µ–∑ WebSocket
7. **JSON persistence**: –ù–µ PostgreSQL, –∏—Å–ø–æ–ª—å–∑—É–π PersistentStorage

–ü—Ä–∏ —Å–æ–º–Ω–µ–Ω–∏—è—Ö ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü—Ä–∏ –æ—à–∏–±–∫–∞—Ö ‚Äî —Å–Ω–∞—á–∞–ª–∞ –∞–Ω–∞–ª–∏–∑–∏—Ä—É–π, –ø–æ—Ç–æ–º –∏—Å–ø—Ä–∞–≤–ª—è–π.
