# Руководство по тестированию ReAct режима

## Обзор

ReAct режим - это адаптивный режим выполнения задач, где агент:
- Анализирует ситуацию после каждого действия
- Динамически выбирает следующее действие
- Пробует альтернативные пути при ошибках
- Показывает полный reasoning trail (процесс мышления)

## Быстрый старт

1. **Запустите backend:**
   ```bash
   python -m src.api.server
   ```

2. **Запустите frontend:**
   ```bash
   cd frontend && npm run dev
   ```

3. **Откройте браузер:** `http://localhost:5173`

4. **Выберите режим "ReAct"** в выпадающем списке режимов выполнения

## Тестовые сценарии

### 1. Простая задача - создание таблицы

**Запрос:**
```
Создай таблицу 'Тест ReAct' и добавь в неё одну строку с данными: ['Имя', 'Возраст', 'Город']
```

**Что проверить:**
- ✅ Reasoning blocks отображаются в UI
- ✅ Видны шаги: "Итерация 1 - Анализ", "Итерация 1 - Действие", "Итерация 1 - Наблюдение"
- ✅ Агент создает таблицу
- ✅ Агент добавляет строку с данными
- ✅ Финальный результат отображается

**Ожидаемое поведение:**
- Агент должен проанализировать задачу
- Выбрать инструмент `create_spreadsheet`
- Выполнить действие
- Проанализировать результат
- Выбрать следующий инструмент (`add_rows` или `update_cells`)
- Завершить задачу

### 2. Задача с ошибкой и восстановлением

**Запрос:**
```
Создай таблицу 'Тест Ошибка', найди её, и добавь строку ['A', 'B', 'C']
```

**Что проверить:**
- ✅ Агент создает таблицу
- ✅ Если поиск не находит таблицу сразу, агент пробует альтернативные варианты
- ✅ Агент адаптируется и находит решение
- ✅ Reasoning blocks показывают процесс адаптации

**Ожидаемое поведение:**
- Агент может попробовать несколько вариантов поиска
- Если один путь не работает, агент пробует другой
- Reasoning blocks показывают "Итерация X - Адаптация"

### 3. Комплексная задача

**Запрос:**
```
Создай таблицу 'Проекты', добавь заголовки ['Название', 'Статус', 'Срок'], 
затем добавь 3 строки с тестовыми данными
```

**Что проверить:**
- ✅ Агент разбивает задачу на шаги
- ✅ Каждый шаг анализируется отдельно
- ✅ Reasoning blocks показывают прогресс
- ✅ Все шаги выполняются последовательно

**Ожидаемое поведение:**
- Множественные итерации ReAct цикла
- Каждая итерация показывает анализ, действие, наблюдение
- Финальный результат содержит все требуемые данные

### 4. Задача с неопределенностью

**Запрос:**
```
Найди таблицу с названием, содержащим 'Тест', и покажи её содержимое
```

**Что проверить:**
- ✅ Агент ищет таблицу
- ✅ Если таблица не найдена, агент сообщает об этом
- ✅ Если найдено несколько таблиц, агент выбирает подходящую
- ✅ Reasoning blocks показывают процесс принятия решений

## Проверка UI

### Reasoning Blocks

1. **Визуальная проверка:**
   - Reasoning blocks должны быть видны (зеленые блоки)
   - Блоки должны быть развернуты по умолчанию
   - Контент должен быть читаемым

2. **Содержимое блоков:**
   - "Итерация X - Анализ" - показывает анализ ситуации
   - "Итерация X - Действие" - показывает выбранное действие и инструмент
   - "Итерация X - Наблюдение" - показывает результат действия
   - "Итерация X - Адаптация" - показывает изменение стратегии (если есть)

3. **Markdown рендеринг:**
   - Заголовки отображаются правильно
   - Списки отображаются правильно
   - Код отображается правильно

### Ответы агента

1. **Финальный результат:**
   - Должен отображаться после завершения ReAct цикла
   - Должен содержать итоговую информацию о выполненной задаче

2. **Ошибки:**
   - Если задача не может быть выполнена, должно быть понятное сообщение об ошибке
   - Reasoning trail должен показывать, что было попробовано

## Проверка логирования

### Backend логи

Проверьте логи backend на наличие:
- `[ReActOrchestrator]` - логи оркестратора
- `[ResultAnalyzer]` - логи анализатора результатов
- WebSocket события: `react_start`, `react_thinking`, `react_action`, `react_observation`, `react_complete`

### Frontend логи

В консоли браузера проверьте:
- `[ChatInterface] ReAct mode - rendering reasoning blocks directly`
- `[WebSocket] ReAct event received`
- `[chatStore] updateReasoningBlock`

## Известные ограничения

1. **Максимальное количество итераций:** 10 (настраивается в `ReActOrchestrator`)
2. **Таймаут:** Если задача слишком сложная, может быть достигнут лимит итераций
3. **Инструменты:** Доступны только те инструменты, которые подключены через MCP

## Отладка проблем

### Reasoning blocks не отображаются

1. Проверьте, что выбран режим "ReAct"
2. Проверьте консоль браузера на ошибки
3. Проверьте, что WebSocket соединение установлено
4. Проверьте логи backend на наличие событий `react_*`

### Агент не выполняет действия

1. Проверьте логи backend на ошибки выполнения инструментов
2. Проверьте, что MCP серверы запущены
3. Проверьте, что инструменты доступны (логи `[ReActOrchestrator] Available tools`)

### Агент зацикливается

1. Проверьте логи на повторяющиеся действия
2. Убедитесь, что задача четко сформулирована
3. Проверьте, что агент получает правильные результаты от инструментов

## Следующие шаги

После успешного тестирования:
1. Удалите отладочное логирование (если оно было добавлено)
2. Оптимизируйте промпты для лучших результатов
3. Настройте параметры (max_iterations, model_name) под ваши нужды
4. Добавьте дополнительные инструменты, если нужно
