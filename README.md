# Google Workspace Multi-Agent System

Продвинутая мультиагентная AI-система, которая оркестрирует Gmail, Google Calendar и Google Sheets через MCP (Model Context Protocol) с React фронтендом для взаимодействия в реальном времени.

## Возможности

- **Мультиагентная архитектура**: Специализированные агенты для операций с Email, Calendar и Sheets
- **Коммуникация в реальном времени**: Обновления через WebSocket с визуализацией рассуждений
- **Режимы выполнения**: Мгновенное выполнение или рабочий процесс с подтверждением
- **Интеграция MCP**: Бесшовная интеграция с MCP серверами Gmail, Calendar и Sheets
- **OAuth 2.0 аутентификация**: Все операции выполняются от имени аутентифицированного пользователя
- **Комплексное логирование**: Структурированное логирование и аудит-трейл

## Архитектура

```
┌─────────────────┐
│  React Frontend │
└────────┬────────┘
         │ WebSocket
┌────────▼────────────────┐
│   FastAPI Backend      │
└────────┬────────────────┘
         │
┌────────▼────────────────┐
│   Main Orchestrator      │
│   (LangGraph Agent)      │
└────────┬────────────────┘
         │
    ┌────┴────┬──────────┐
    │         │          │
┌───▼───┐ ┌──▼───┐ ┌────▼────┐
│Email │ │Calen │ │ Sheets  │
│Agent │ │Agent │ │ Agent   │
└───┬───┘ └──┬───┘ └────┬────┘
    │        │          │
┌───▼───┐ ┌──▼───┐ ┌────▼────┐
│Gmail │ │Calen │ │ Sheets  │
│ MCP  │ │ MCP  │ │  MCP    │
└───────┘ └──────┘ └─────────┘
```

## Быстрый старт

### Требования

- Python 3.10+
- Node.js 18+
- Google Cloud Project с включенными API
- Установленные и настроенные MCP серверы

### Настройка Backend

1. **Установите зависимости:**
   ```bash
   pip install -r requirements.txt
   ```

2. **Настройте окружение:**
   ```bash
   cp config/.env.example config/.env
   # Отредактируйте config/.env с вашими учетными данными
   ```

3. **Настройте MCP серверы:**
   - Быстрый старт: см. `QUICKSTART.md` или `docs/mcp-quick-start.md`
   - Подробные инструкции: см. `docs/mcp-setup.md`
   
   **Важно**: MCP серверы автоматически запускаются приложением при старте.

4. **Настройте Google аутентификацию:**
   См. `docs/google-auth-setup.md` для подробных инструкций.

5. **Запустите backend:**
   ```bash
   python src/main.py
   # Или используйте uvicorn напрямую:
   uvicorn src.api.server:app --reload
   ```

### Настройка Frontend

1. **Установите зависимости:**
   ```bash
   cd frontend
   npm install
   ```

2. **Запустите dev сервер:**
   ```bash
   npm run dev
   ```

3. **Соберите для production:**
   ```bash
   npm run build
   ```

## Конфигурация

### Переменные окружения

Ключевые опции конфигурации в `config/.env`:

**API Keys (нужен хотя бы один):**
- `ANTHROPIC_API_KEY`: Ваш Anthropic API ключ (для Claude моделей)
- `OPENAI_API_KEY`: Ваш OpenAI API ключ (для GPT-4o и o1 моделей)

**Модели:**
- `DEFAULT_MODEL`: Модель по умолчанию (по умолчанию: `gpt-4o`)
  - Доступные модели: `claude-sonnet-4-5`, `gpt-4o`, `o1`, `o1-mini`

**Google OAuth:**
- `GOOGLE_OAUTH_CLIENT_ID`: OAuth client ID (обязательно)
- `GOOGLE_OAUTH_CLIENT_SECRET`: OAuth client secret (обязательно)

**MCP Endpoints:**
- `GMAIL_MCP_ENDPOINT`: Endpoint MCP сервера Gmail
- `CALENDAR_MCP_ENDPOINT`: Endpoint MCP сервера Calendar
- `SHEETS_MCP_ENDPOINT`: Endpoint MCP сервера Sheets

**Настройки приложения:**
- `APP_TIMEZONE`: Часовой пояс по умолчанию (по умолчанию: Europe/Moscow)

### Поддерживаемые модели

Система поддерживает несколько моделей с разными возможностями:

**Claude Sonnet 4.5** (`claude-sonnet-4-5`):
- Провайдер: Anthropic
- Reasoning: Extended Thinking (встроенный режим рассуждений)
- Требует: `ANTHROPIC_API_KEY`

**GPT-4o** (`gpt-4o`):
- Провайдер: OpenAI
- Reasoning: Нет (стандартная модель)
- Требует: `OPENAI_API_KEY`
- Модель по умолчанию

**OpenAI o1** (`o1`):
- Провайдер: OpenAI
- Reasoning: Native (нативный режим рассуждений)
- Требует: `OPENAI_API_KEY`

**OpenAI o1-mini** (`o1-mini`):
- Провайдер: OpenAI
- Reasoning: Native (нативный режим рассуждений)
- Требует: `OPENAI_API_KEY`

Выбор модели доступен в интерфейсе через dropdown в области ввода (как в Cursor).

## Использование

### Режимы выполнения

**Режим мгновенного выполнения (по умолчанию):**
- Агент выполняет задачи сразу после подтверждения
- Более быстрый рабочий процесс для доверенных операций

**Режим с подтверждением:**
- Агент сначала создает детальный план
- Пользователь просматривает и одобряет перед выполнением
- Лучше для чувствительных операций

### Примеры взаимодействия

**Calendar:**
```
Пользователь: "Запланируй встречу с Иваном в следующий вторник в 14:00"
Агент: "Создам встречу с Иваном во вторник в 14:00. Продолжить?"
Пользователь: "Да"
Агент: "✅ Встреча создана: [детали]"
```

**Email:**
```
Пользователь: "Отправь сводное письмо команде"
Агент: "Подготовлю и отправлю сводное письмо. Продолжить?"
Пользователь: "Да"
Агент: "✅ Письмо отправлено [получателям]"
```

**Многошаговый:**
```
Пользователь: "Запланируй встречу и запиши результаты в таблицу"
Агент: [Создает событие календаря] → [Записывает в таблицу]
Агент: "✅ Встреча запланирована и результаты записаны"
```

## Структура проекта

```
universal-multiagent/
├── src/
│   ├── agents/          # Реализации агентов
│   ├── api/             # FastAPI backend
│   ├── core/            # Основная функциональность
│   ├── mcp_tools/       # Обертки MCP инструментов
│   ├── utils/           # Утилиты
│   └── main.py          # Точка входа
├── frontend/            # React frontend
├── config/             # Файлы конфигурации
├── docs/                # Документация
└── tests/               # Тесты
```

## Разработка

### Запуск тестов

```bash
pytest tests/
```

### Стиль кода

```bash
black src/
```

### Проверка типов

```bash
mypy src/
```

## Деплой

### Production Deployment

Проект готов к деплою на Railway или другие платформы. Подробные инструкции:

- [Руководство по деплою](docs/DEPLOYMENT.md) - полное руководство по деплою
- [Быстрая настройка Railway](docs/RAILWAY_SETUP.md) - пошаговая инструкция для первого деплоя

### Быстрый старт для деплоя

1. Создайте production ветку:
   ```bash
   git checkout -b production
   ```

2. Синхронизируйте изменения из main:
   ```bash
   ./scripts/sync-to-prod.sh
   ```

3. Следуйте инструкциям в [RAILWAY_SETUP.md](docs/RAILWAY_SETUP.md)

## Документация

- [Руководство по настройке MCP](docs/mcp-setup.md)
- [Настройка Google аутентификации](docs/google-auth-setup.md)
- [Руководство по деплою](docs/DEPLOYMENT.md)
- [Быстрая настройка Railway](docs/RAILWAY_SETUP.md)
- [Справочник API](docs/api-reference.md) (скоро)
- [Руководство пользователя](docs/user-guide.md) (скоро)

## Лицензия

MIT

## Вклад в проект

Вклад приветствуется! Пожалуйста, откройте issue или отправьте pull request.
