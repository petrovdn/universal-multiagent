# План тестирования Workspace Panel

## Шаг 1: Запуск приложения

### Backend:
```bash
# В первом терминале
cd /Users/Dima/universal-multiagent
python3 -m uvicorn src.api.server:app --reload --host 0.0.0.0 --port 8000
```

### Frontend:
```bash
# Во втором терминале
cd /Users/Dima/universal-multiagent/frontend
npm run dev
```

### MCP серверы (если нужны):
```bash
# В третьем терминале (для Google Sheets)
./scripts/start-workspace-mcp.sh
```

---

## Шаг 2: Тестовые сценарии

### ✅ Тест 1: Создание Google Sheets
**Запрос:**
```
Создай таблицу "Тест продаж" с колонками: Дата, Товар, Количество, Цена
```

**Ожидаемый результат:**
- ✅ Таблица создается
- ✅ В правой панели автоматически открывается вкладка "Тест продаж"
- ✅ Вкладка содержит iframe с Google Sheets
- ✅ Можно видеть созданную таблицу в реальном времени

---

### ✅ Тест 2: Обновление таблицы
**Запрос:**
```
Добавь в таблицу "Тест продаж" строку: 2024-01-01, Ноутбук, 5, 50000
```

**Ожидаемый результат:**
- ✅ Строка добавляется в таблицу
- ✅ Если вкладка уже открыта - она обновляется
- ✅ Если вкладка закрыта - она открывается автоматически

---

### ✅ Тест 3: Создание Google Docs
**Запрос:**
```
Создай документ "Отчет о продажах" с текстом "Продажи за январь составили 250000 рублей"
```

**Ожидаемый результат:**
- ✅ Документ создается
- ✅ В правой панели открывается вкладка "Отчет о продажах"
- ✅ Вкладка содержит iframe с Google Docs
- ✅ Можно видеть созданный документ

---

### ✅ Тест 4: Email Preview
**Запрос:**
```
Напиши письмо на адрес test@example.com с темой "Отчет" и текстом "Привет, вот отчет"
```

**Ожидаемый результат:**
- ✅ В правой панели открывается вкладка "Email: Отчет"
- ✅ Вкладка показывает предпросмотр письма:
  - Кому: test@example.com
  - Тема: Отчет
  - Содержание: Привет, вот отчет
- ✅ Письмо отправляется после подтверждения

---

### ✅ Тест 5: Python Code Execution
**Запрос:**
```
Выполни код на Python: 
result = [x * 2 for x in range(1, 6)]
```

**Ожидаемый результат:**
- ✅ Код выполняется
- ✅ В правой панели открывается вкладка "executed_code.py"
- ✅ Вкладка показывает код с подсветкой синтаксиса
- ✅ Можно скопировать код

---

### ✅ Тест 6: Множественные вкладки
**Запрос:**
```
Создай таблицу "Таблица 1", затем создай таблицу "Таблица 2"
```

**Ожидаемый результат:**
- ✅ Открываются две вкладки
- ✅ Можно переключаться между ними
- ✅ Можно закрывать вкладки крестиком
- ✅ Активная вкладка подсвечивается

---

### ✅ Тест 7: Resize панелей
**Действие:**
- Перетащите разделитель между чатом и workspace панелью

**Ожидаемый результат:**
- ✅ Панели изменяют размер
- ✅ Размер сохраняется в localStorage
- ✅ При перезагрузке размер восстанавливается

---

### ✅ Тест 8: Placeholder
**Действие:**
- Откройте приложение без открытых вкладок

**Ожидаемый результат:**
- ✅ В правой панели показывается PlaceholderViewer
- ✅ Отображаются инструкции и иконки типов панелей

---

## Шаг 3: Проверка WebSocket событий

Откройте DevTools (F12) → Console и проверьте логи:

### Ожидаемые события:
```javascript
[WebSocket] Received event: sheets_action {spreadsheet_id: "...", ...}
[WebSocket] Received event: docs_action {document_id: "...", ...}
[WebSocket] Received event: email_preview {to: "...", ...}
[WebSocket] Received event: code_display {filename: "...", ...}
```

---

## Возможные проблемы

### 1. Вкладки не открываются автоматически
**Решение:**
- Проверьте консоль браузера на ошибки
- Убедитесь, что WebSocket подключен
- Проверьте логи backend на наличие событий

### 2. Iframe не загружается
**Решение:**
- Проверьте URL таблицы/документа
- Убедитесь, что у вас есть доступ к Google Sheets/Docs
- Проверьте CORS настройки

### 3. Ошибки TypeScript
**Решение:**
- Ошибки в ChatInterface.tsx не критичны для тестирования
- Можно игнорировать или исправить позже

### 4. Workspace панель не видна
**Решение:**
- Проверьте, что `isPanelVisible` установлен в `true`
- Убедитесь, что есть открытые вкладки
- Проверьте CSS стили

---

## Чеклист тестирования

- [ ] Backend запущен и работает
- [ ] Frontend запущен и работает
- [ ] WebSocket подключен
- [ ] Создание таблицы открывает вкладку
- [ ] Создание документа открывает вкладку
- [ ] Email preview работает
- [ ] Code viewer работает
- [ ] Можно закрывать вкладки
- [ ] Можно переключаться между вкладками
- [ ] Resize панелей работает
- [ ] Размер панелей сохраняется
- [ ] Placeholder показывается когда нет вкладок

---

## Дополнительные тесты (опционально)

### Тест 9: Calendar (если реализовано)
**Запрос:**
```
Покажи мой календарь
```

### Тест 10: Chart (если реализовано)
**Запрос:**
```
Создай график продаж по месяцам
```

---

## Отчет о тестировании

После тестирования заполните:

- ✅ Работает: ...
- ❌ Не работает: ...
- ⚠️ Требует доработки: ...

